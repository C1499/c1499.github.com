
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>你真的理解JSON.stringify()吗 | Stage : One ? Two</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="ECMAScript 5定义了JSON对象，对JSON的行为进行了规范，这个对象有两个方法：stringify()和parse()。先看下面这个例子：123456789101112131415161718let people = &amp;#123;  name: &#39;YY&#39;,  age: 20,  gender: &#39;male&#39;,  address: &amp;#123;    city: &#39;xxx&#39;,    street: &#39;linyindadao&#39;  &amp;#125;,  skill: [&#39;JavaScript&#39;, &#39;PHP&#39;, &#39;Python&#39;, undefined],  phone: undefined&amp;#125;JSON.strin...">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>

<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">Stage : One ? Two</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            How goes the world with you?
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    <article id="post">
        <h1>你真的理解JSON.stringify()吗</h1>
        <div class="create">
            <span>创建于</span>
            
                <time datetime="2018-10-27T12:32:52.000Z">
                    2018-10-27
                </time>
            
            <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript/">JavaScript</a></li></ul>
        </div>
        <p>ECMAScript 5定义了JSON对象，对JSON的行为进行了规范，这个对象有两个方法：<code>stringify()</code>和<code>parse()</code>。<br>先看下面这个例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> people = &#123;</div><div class="line">  name: <span class="string">'YY'</span>,</div><div class="line">  age: <span class="number">20</span>,</div><div class="line">  gender: <span class="string">'male'</span>,</div><div class="line">  address: &#123;</div><div class="line">    city: <span class="string">'xxx'</span>,</div><div class="line">    street: <span class="string">'linyindadao'</span></div><div class="line">  &#125;,</div><div class="line">  skill: [<span class="string">'JavaScript'</span>, <span class="string">'PHP'</span>, <span class="string">'Python'</span>, <span class="literal">undefined</span>],</div><div class="line">  phone: <span class="literal">undefined</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">JSON</span>.stringify(people, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value !== <span class="string">'string'</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> value</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 返回值undefined</span></div></pre></td></tr></table></figure></p>
<p>上面这块代码的本意是只想序列化出值为字符串的属性，但是返回的值是undefined。接下来让我们一探究竟。首先来详细了解一下<code>JSON.stringify()</code>这个方法。<br><a id="more"></a></p>
<h2 id="用法和处理规则"><a href="#用法和处理规则" class="headerlink" title="用法和处理规则"></a>用法和处理规则</h2><p><code>JSON.stringify()</code>是将可以把JavaScript对象转化为JSON字符串。接收三个参数：<br>1.要序列化的JavaScript对象（必须）<br>2.一个数组或一个函数（可选），可以做序列化筛选和处理<br>3.指定缩进的空白符（可选）<br>接下来有必要了解一下序列化的详细规则</p>
<blockquote>
<p>1.非数组对象的属性不能保证以特定的顺序出现在序列化后的字符串中。<br>2.布尔值、数字、字符串的包装对象在序列化过程中会自动转换成对应的原始值。<br>undefined、任意的函数以及 symbol 值，在序列化过程中会被忽略（出现在非数组对象的属性值中时）或者被转换成 null（出现在数组中时）。<br>3.所有以 symbol 为属性键的属性都会被完全忽略。<br>4.不可枚举的属性会被忽略<br>5.所有函数（toJSON除外）及原型成员都会被忽略</p>
</blockquote>
<p>有了上面这个基础，我们接下来一一实践。</p>
<h2 id="序列化筛选过滤"><a href="#序列化筛选过滤" class="headerlink" title="序列化筛选过滤"></a>序列化筛选过滤</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 一个参数</span></div><div class="line"><span class="built_in">JSON</span>.stringify(people)</div><div class="line"></div><div class="line"><span class="comment">// &#123;"name":"YY","age":20,"gender":"male","address":&#123;"city":"xxx","street":"linyindadao"&#125;,"skill":["JavaScript","PHP","Python", null]&#125;</span></div><div class="line"></div><div class="line"><span class="comment">// 第二个参数为数组，筛选出key为name和age</span></div><div class="line"><span class="built_in">JSON</span>.stringify(people, [<span class="string">'name'</span>, <span class="string">'age'</span>])</div><div class="line"></div><div class="line"><span class="comment">//&#123;"name":"YY","age":20&#125;</span></div></pre></td></tr></table></figure>
<p>在文章刚开始的例子中，第二个参数是一个函数，它接收两个参数，分别是对象的键和值，键只能是字符串，而在值并非键值对儿结构的值时，键名可以是空字符串，该函数必须要有返回值。但是我们发现返回值是undefined。这是为什么呢，在该函数中将key和value打印出来，发现函数在第一次执行时key为””,value为<code>people</code>整个对象。这里我们就知道原因了，<code>JSON.stringify()</code>时，第一次value是整个对象，在上面的例子中直接被返回undefined了，以至于后续的结果被忽略改变了。这里我们将key，value打印出来。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">JSON</span>.stringify(people, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(key, value)</div><div class="line">  <span class="keyword">return</span> value</div><div class="line">&#125;)</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">结果依次如下：</span></div><div class="line"><span class="comment">"" &#123;name: "YY", age: 20, gender: "male", address: &#123;…&#125;, skill: Array(3), phone: undefined&#125;</span></div><div class="line"><span class="comment">name "YY"</span></div><div class="line"><span class="comment">age 20</span></div><div class="line"><span class="comment">gender "male"</span></div><div class="line"><span class="comment">address &#123;city: "xxx", street: "linyindadao"&#125; </span></div><div class="line"><span class="comment">city "xxx"</span></div><div class="line"><span class="comment">street "linyindadao"</span></div><div class="line"><span class="comment">skill ["JavaScript", "PHP", "Python", undefined]</span></div><div class="line"><span class="comment">0 "JavaScript"</span></div><div class="line"><span class="comment">1 "PHP"</span></div><div class="line"><span class="comment">2 "Python"</span></div><div class="line"><span class="comment">undefined undefined</span></div><div class="line"><span class="comment">phone undefined</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<p>由上面的打印结果可见，<code>JSON.stringify()</code>是依次遍历每一个值，根据上面的规则做序列化处理。这样我们可以对第一个例子稍作修改，就可达到想要的效果。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">JSON</span>.stringify(people, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'object'</span> || <span class="keyword">typeof</span> value === <span class="string">'string'</span>) &#123;</div><div class="line">  	<span class="keyword">return</span> value</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">undefined</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">// &#123;"name":"YY","gender":"male","address":&#123;"city":"xxx","street":"linyindadao"&#125;,"skill":["JavaScript","PHP","Python",null]&#125;</span></div></pre></td></tr></table></figure></p>
<h2 id="缩进和空白"><a href="#缩进和空白" class="headerlink" title="缩进和空白"></a>缩进和空白</h2><p><code>JSON.stringify()</code>方法的第三个参数用于控制序列化结果的缩进和空白符。它的参数可以是一个数值，表示每一个级别的缩进的空格数，比如这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">JSON</span>.stringify(people, <span class="literal">null</span>, <span class="number">2</span>)</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">&#123;</span></div><div class="line"><span class="comment">  "name": "YY",</span></div><div class="line"><span class="comment">  "age": 20,</span></div><div class="line"><span class="comment">  "gender": "male",</span></div><div class="line"><span class="comment">  "address": &#123;</span></div><div class="line"><span class="comment">    "city": "xxx",</span></div><div class="line"><span class="comment">    "street": "linyindadao"</span></div><div class="line"><span class="comment">  &#125;,</span></div><div class="line"><span class="comment">  "skill": [</span></div><div class="line"><span class="comment">    "JavaScript",</span></div><div class="line"><span class="comment">    "PHP",</span></div><div class="line"><span class="comment">    "Python",</span></div><div class="line"><span class="comment">    null</span></div><div class="line"><span class="comment">  ]</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<p>这样看起来可读性更好，该数值最大缩进空格数为10，如果大于10会被转换成10。<br>除此之外，它还可以是一个或多个其他字符组起来的字符串，并且如果字符串的长度超过了10个，那么也只出现前十个字符，比如这样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">JSON</span>.stringify(people, <span class="literal">null</span>, <span class="string">'=='</span>)</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">&#123;</span></div><div class="line"><span class="comment">=="name": "YY",</span></div><div class="line"><span class="comment">=="age": 20,</span></div><div class="line"><span class="comment">=="gender": "male",</span></div><div class="line"><span class="comment">=="address": &#123;</span></div><div class="line"><span class="comment">===="city": "xxx",</span></div><div class="line"><span class="comment">===="street": "linyindadao"</span></div><div class="line"><span class="comment">==&#125;,</span></div><div class="line"><span class="comment">=="skill": [</span></div><div class="line"><span class="comment">===="JavaScript",</span></div><div class="line"><span class="comment">===="PHP",</span></div><div class="line"><span class="comment">===="Python",</span></div><div class="line"><span class="comment">====null</span></div><div class="line"><span class="comment">==]</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<h2 id="toJSON"><a href="#toJSON" class="headerlink" title="toJSON()"></a>toJSON()</h2><p>当JSON.stringify()不能够满足需求的时候，这时候<code>toJSON()</code>就派上用场了。我们可以给对象定义一个toJSON方法，那么在调用<code>JSON.stringify()</code>时不是该对象被序列化，而是<code>toJSON()</code>这个方法的返回值被序列化。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p1 = &#123;</div><div class="line">  ...people,</div><div class="line">  toJSON () &#123;</div><div class="line">  	<span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>==&gt;<span class="subst">$&#123;<span class="keyword">this</span>.skill[<span class="number">0</span>]&#125;</span>`</span></div><div class="line">  &#125;	</div><div class="line">&#125;</div><div class="line"><span class="comment">// "YY==&gt;JavaScript"</span></div></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由上面的例子我们可以知道，在将一个对象传给<code>JOSN.stringify()</code>序列化时，顺序如下：</p>
<blockquote>
<p>1.如果存在toJSON()方法而且能通过它取得有效的值，则调用该方法。否则，返回对象本身。<br>2.如果提供了第二个参数，应用这个函数过滤器。传入函数过滤器的值是第1步返回的值。<br>3.对第2步返回的每个值进行相应的序列化。<br>4.如果提供了第三个参数，做相应的格式化处理。</p>
</blockquote>

        <div>
            <ul class="tags-category-list"><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/JSON/">JSON</a></li><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/stringify/">stringify</a></li></ul>
        </div>
        <div class="bottom-line"></div>
        
    <nav id="article-nav">
        
        
            <a href="/2018/08/04/stage/" id="article-nav-older" class="article-nav-link-wrap">
                <strong class="article-nav-caption">&lt;</strong>
                <span class="article-nav-title">
                    
                        Hello Stage
                </span>
                
            </a>
        
    </nav>


        
            <div id="stageComment" class="comment" style="margin-top: 27px;"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
  var notify = 'false' == true ? true : false;
  var verify = 'false' == true ? true : false;
  window.onload = function() {
    new Valine({
      el: '#stageComment',
      notify: notify,
      verify: verify,
      app_id: "6Q3xRwM97frlrEeH1ybox5l6-gzGzoHsz",
      app_key: "XbePHedfhUu8B8SAa1mfqvzS",
      placeholder: "Stage,show",
      avatar:"mm"
    });
  }
</script>

        
    </article>
    <div id="toc">
        
            <h2>文章目录</h2>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法和处理规则"><span class="toc-number">1.</span> <span class="toc-text">用法和处理规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#序列化筛选过滤"><span class="toc-number">2.</span> <span class="toc-text">序列化筛选过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缩进和空白"><span class="toc-number">3.</span> <span class="toc-text">缩进和空白</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toJSON"><span class="toc-number">4.</span> <span class="toc-text">toJSON()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol>
        
    </div>
</div>

    </div>
</div>
<footer id="footer">
    <div id="copyright">&copy; Mark  2018</div>
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/smooth-scroll.min.js"></script>
    <script src="/js/toc.main.js"></script>

</body>
</html>
